
{% extends 'dashboard/main.html' %}
{% load static %}

{% block content %}

<div class="main-content">
  <section class="section">
    <div class="section-body">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h4>Edit Product</h4>
            </div>
            <div class="card-body">
              <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.non_field_errors }}
                <div class="row">
                  <div class="col-md-8">
                    {% for field in form.visible_fields %}
                      <div class="form-group">
                        {{ field.label_tag }}
                        {{ field }}
                        {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text }}</small>{% endif %}
                        {% for error in field.errors %}
                          <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                      </div>
                    {% endfor %}
                  </div>
                  <div class="col-md-4">
                    <label>Current Images</label>
                    <div class="row">
                      {% for image in product_images %}
                        <div class="col-6 mb-2">
                          <img src="{{ image.image.url }}" class="img-fluid rounded mb-1" alt="Product Image">
                            <button type="button" class="btn btn-danger btn-sm btn-block mt-1" onclick="deleteImage('{{ image.pk }}')">Delete</button>
                          {% if image.is_main %}<span class="badge badge-primary">Main</span>{% endif %}
                        </div>
                      {% empty %}
                        <div class="col-12 text-muted">No images uploaded.</div>
                      {% endfor %}
                    </div>
                    <div class="form-group mt-3">
                      <label>Add Images (max 5)</label>
                      {{ form.images }}
                    </div>
                  </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a href="{% url 'products' %}" class="btn btn-secondary">Cancel</a>
              </form>
                <form id="deleteImageForm" method="post" style="display:none;">
                  {% csrf_token %}
                </form>
                <script>
                  function deleteImage(imageId) {
                    if (confirm('Delete this image?')) {
                      var form = document.getElementById('deleteImageForm');
                      form.action = '/dashboard/product/image/' + imageId + '/delete/';
                      form.submit();
                    }
                  }
                </script>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
